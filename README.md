# QueryAnalysis
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

## Getting Started
### Prerequisites
You need to have `Maven`, `OpenJDK 8` and `Python 2` installed.

### Installing
```shell
$ mvn clean package
```

**Important** To find duplicate query types we use [fdupes](https://github.com/adrianlopezroche/fdupes). If you wish to synchronize the query types please clone the given repository and create an executable using:
```shell
$ make fdupes
```

### Running the main Java log analyser
```shell
# Processes the example SPARQL log files into exampleMonthsFolder/exampleMonth/processedLogData
$ mvn exec:java@QueryAnalysis -Dexec.args="-w exampleMonthsFolder/exampleMonth -logging"

# There are more (useful) CLI parameter available, you can list them with:
$ mvn exec:java@QueryAnalysis -Dexec.args="--help"

```

**Important:** In order to not flush the command line with error messages all uncatched Runtime Exceptions are being written to the log files, residing in the logs/ folder, so please have a look at those regularly. The logs are not generated by default, so you should enable them using the `-l` option.

**Important** After the java application is done, the `#QueryType` field is not synchronized across days or months. To remedy that, run the script unifyQueryTypes.py like this:
```shell
$ python unifyQueryTypes.py /month/folder/ -r /queryType/reference/folder -f /fdupes/executable/fdupes
```

### Running the QueryAnalysis-Script
The QueryAnalysis-Script handles all three steps: Extraction using hive, processing using the java application and synchronizing using unifyQueryTypes.py. Extraction using hive only works on the server, but is ignored if the month exists in the months folder. To run the QueryAnalysis-Script locally, you need to provide the local months folder, the fdupes executable and a query type reference folder.
```shell
$ python QueryAnalysis exampleMonth -m ../exampleMonthsFolder -f /fdupes/executable/fdupes -r /queryType/reference/folder

# You can also specify multiple months in the same directory by separating them using commas
$ python QueryAnalysis exampleMonth,otherMonth -m ../exampleMonthsFolder -f /fdupes/executable/fdupes -r /queryType/reference/folder
```


## License
The code in this repository is released under the [Apache 2.0](LICENSE.txt) license. External libraries used may have their own licensing terms.
